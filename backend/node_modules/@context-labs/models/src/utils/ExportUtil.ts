import { AsyncParser } from 'json2csv';

function fromJson(fields: string[], data: object): Promise<string> {
  return new Promise((resolve, reject) => {
    const params = { fields };
    const options = {};
    const json = JSON.stringify(data);
    const parser = new AsyncParser(params, options);

    let file = '';
    parser.processor
      .on('data', (data: any) => {
        file += data.toString();
      })
      .on('end', () => resolve(file))
      .on('error', (err: any) => reject(err));

    parser.input.push(json);
    // Must push null at the end
    parser.input.push(null);
  });
}

const ExportUtil = {
  fromJson,
};

export default ExportUtil;
